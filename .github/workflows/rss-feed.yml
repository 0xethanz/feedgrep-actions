name: ğŸ“¡ FeedGrep RSS Feed Processing

on:
  schedule:
    # æ¯å¤© UTC æ—¶é—´ 02:00 è¿è¡Œ (åŒ—äº¬æ—¶é—´ 10:00)
    - cron: '0 2 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # åœ¨æäº¤åˆ°mainåˆ†æ”¯æ—¶ä¹Ÿè¿è¡Œ
  push:
    branches:
      - main
    paths:
      - 'feedgrep.yaml'
      - '.github/workflows/rss-feed.yml'

jobs:
  fetch-feeds:
    runs-on: ubuntu-latest
    
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install feedparser pyyaml requests
      
      - name: ğŸš€ å¤„ç†RSSæº
        run: |
          python fetch_feeds_github.py \
            --config feedgrep.yaml \
            --token ${{ secrets.GH_TOKEN }} \
            --owner ${{ github.repository_owner }} \
            --repo ${{ github.event.repository.name }}
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
      
      - name: ğŸ”” è§¦å‘é¡µé¢æ„å»ºå·¥ä½œæµ
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GH_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/build-pages.yml/dispatches \
            -d '{"ref":"main"}'
        continue-on-error: true

  notify:
    runs-on: ubuntu-latest
    needs: fetch-feeds
    if: always()
    
    steps:
      - name: ğŸ“§ å‘é€å®Œæˆé€šçŸ¥
        run: |
          if [ "${{ needs.fetch-feeds.result }}" = "success" ]; then
            echo "âœ… RSSå¤„ç†å®Œæˆ"
          else
            echo "âš ï¸ RSSå¤„ç†é‡åˆ°é—®é¢˜"
          fi
