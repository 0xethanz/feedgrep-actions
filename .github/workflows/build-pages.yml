name: ðŸŒ Build & Deploy GitHub Pages

on:
  # ç”±RSSå¤„ç†å·¥ä½œæµè§¦å‘
  workflow_dispatch:
  
  # ä¹Ÿå¯ä»¥åœ¨æäº¤ä»£ç æ—¶æ‰‹åŠ¨æž„å»º
  push:
    branches:
      - main
    paths:
      - '.github/workflows/build-pages.yml'
      - 'build_static_pages.py'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ðŸ è®¾ç½®PythonçŽ¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ðŸ“¦ å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install requests pyyaml
      
      - name: ðŸ”¨ æž„å»ºé™æ€é¡µé¢
        run: |
          python build_static_pages.py \
            --token ${{ secrets.GH_TOKEN }} \
            --owner ${{ github.repository_owner }} \
            --repo ${{ github.event.repository.name }} \
            --output docs
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
      
      - name: ðŸ“„ å¤åˆ¶å‰ç«¯æ–‡ä»¶
        run: |
          # å¤åˆ¶ä¿®æ”¹è¿‡çš„index.htmlåˆ°docsç›®å½•
          cp index.html docs/index.html 2>/dev/null || true
          
          # åˆ›å»º.nojekyllæ–‡ä»¶ä»¥ç¦ç”¨Jekyllå¤„ç†
          touch docs/.nojekyll
      
      - name: ðŸš€ å‘å¸ƒåˆ°GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'docs'
      
      - name: ðŸŒ éƒ¨ç½²GitHub Pages
        uses: actions/deploy-pages@v4
      
      - name: âœ… ç”Ÿæˆéƒ¨ç½²æ‘˜è¦
        run: |
          echo "## ðŸ“„ Pageséƒ¨ç½²å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”— è®¿é—®åœ°å€" >> $GITHUB_STEP_SUMMARY
          echo "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š APIç«¯ç‚¹" >> $GITHUB_STEP_SUMMARY
          echo "- Feeds: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/api/feeds.json" >> $GITHUB_STEP_SUMMARY
          echo "- Categories: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/api/categories.json" >> $GITHUB_STEP_SUMMARY
          echo "- Items: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/api/items.json" >> $GITHUB_STEP_SUMMARY
